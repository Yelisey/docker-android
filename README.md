<p align="center">
  <img width="400" src="assets/icon.png" />
</p>

# docker-android
> –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π Docker-–æ–±—Ä–∞–∑, –∑–∞–ø—É—Å–∫–∞—é—â–∏–π —ç–º—É–ª—è—Ç–æ—Ä Android –∫–∞–∫ —Å–µ—Ä–≤–∏—Å.

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: **1.0.1**

## üîñ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –Ω–∞ –±–∞–∑–µ Alpine —Å —ç–º—É–ª—è—Ç–æ—Ä–æ–º Android –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π KVM.
- –í –æ–±—Ä–∞–∑–µ –≤—Å—Ç—Ä–æ–µ–Ω–∞ Java Runtime Environment 11.
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è Android, —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Ç–∏–ø—ã –æ–±—Ä–∞–∑–æ–≤.
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ —ç–º—É–ª—è—Ç–æ—Ä–∞ –∏ ADB —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–µ—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- –û–±—Ä–∞–∑—ã —ç–º—É–ª—è—Ç–æ—Ä–∞ –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ headless-—Ä–µ–∂–∏–º–µ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è CI. –°–æ–≤–º–µ—Å—Ç–∏–º —Å–æ [`scrcpy`](https://github.com/Genymobile/scrcpy) –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–º Android.

## üî∞ –û–ø–∏—Å–∞–Ω–∏–µ

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ —Ä–∞–∑–º–µ—Ä—É Docker-–æ–±—Ä–∞–∑ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –ü–û –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–º —ç–º—É–ª—è—Ç–æ—Ä–æ–º Android –ø–æ —Å–µ—Ç–∏. –í –æ–±—Ä–∞–∑–µ —Ç–æ–ª—å–∫–æ —Å–∞–º —ç–º—É–ª—è—Ç–æ—Ä, —Å–µ—Ä–≤–µ—Ä ADB –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑–≤–Ω–µ –∏ QEMU c –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `libvirt`.

–ú–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å —ç—Ç–æ—Ç –æ–±—Ä–∞–∑ –±–µ–∑ Android SDK –∏ —ç–º—É–ª—è—Ç–æ—Ä–∞ Android, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –µ—â—ë –º–µ–Ω—å—à–µ. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–±–æ—Ä–æ–∫:

| –í–∞—Ä–∏–∞–Ω—Ç                   |   –ë–µ–∑ —Å–∂–∞—Ç–∏—è    |  –°–∂–∞—Ç—ã–π      |
|---------------------------|-----------------|--------------|
| API 33 + –≠–º—É–ª—è—Ç–æ—Ä         |      5.84 –ì–ë    |   1.97 –ì–ë    |
| API 32 + –≠–º—É–ª—è—Ç–æ—Ä         |      5.89 –ì–ë    |   1.93 –ì–ë    |
| API 28 + –≠–º—É–ª—è—Ç–æ—Ä         |      4.29 –ì–ë    |   1.46 –ì–ë    |
| –ë–µ–∑ SDK –∏ —ç–º—É–ª—è—Ç–æ—Ä–∞       |      414 –ú–ë     |   138 –ú–ë     |

## üìò –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Å –æ–±—Ä–∞–∑–æ–º –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Android SDK, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ —ç–º—É–ª—è—Ç–æ—Ä.

–ß–µ—Ä–µ–∑ docker-compose:

```bash
docker compose up android-emulator
```

–∏–ª–∏ —Å —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º GPU:

```bash
docker compose up android-emulator-cuda
```

–∏–ª–∏ —Å —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º GPU –∏ Google Play Store:

```bash
docker compose up android-emulator-cuda-store
```

–ò—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ docker:

```bash
docker build -t android-emulator .
```

## –ö–ª—é—á–∏

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–∑ google_apis_playstore, –º–µ–∂–¥—É —ç–º—É–ª—è—Ç–æ—Ä–æ–º –∏ –∫–ª–∏–µ–Ω—Ç–æ–º –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å –∫–ª—é—á–∏ adbkey.

–ú–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∫–æ–º–∞–Ω–¥–æ–π `adb keygen adbkey`, –æ–Ω–∞ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª—ã adbkey –∏ adbkey.pub.

–ü–µ—Ä–µ–∑–∞–ø–∏—à–∏—Ç–µ –∏—Ö –≤ –ø–∞–ø–∫–µ ./keys.

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –º–æ–∂–Ω–æ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å KVM-–¥—Ä–∞–π–≤–µ—Ä –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç ADB.

> –¢—Ä–µ–±—É–µ—Ç—Å—è 4–ì–ë –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ –º–∏–Ω–∏–º—É–º 8–ì–ë –¥–∏—Å–∫–∞ –¥–ª—è API 33.

```bash
docker run -it --rm --device /dev/kvm -p 5555:5555 android-emulator
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

–í—Å–µ avd —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `/data` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∏–º—è avd ‚Äî `android`.

```bash
docker run -it --rm --device /dev/kvm -p 5555:5555 -v ~/android_avd:/data android-emulator
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ADB –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É

–°–µ—Ä–≤–µ—Ä ADB –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ –±—É–¥–µ—Ç —Å–ª—É—à–∞—Ç—å –≤—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã. –ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —è–¥—Ä–∞ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –ø–æ ADB:

```bash
adb connect 127.0.0.1:5555
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [`scrcpy`](https://github.com/Genymobile/scrcpy) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–º—É–ª—è—Ç–æ—Ä–æ–º. –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ ADB –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ scrcpy –ª–æ–∫–∞–ª—å–Ω–æ.

> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç–º—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–µ—Å–µ—Ç–æ–º Pixel (1080x1920).

```bash
scrcpy
```

<br />
<table>
  <tr>
    <td>
      <img width="260" src="assets/screenshot.png" />
    </td>
    <td>
      <img width="260" src="assets/screenshot-2.png" />
    </td>
    <td>
      <img width="260" src="assets/screenshot-3.png" />
    </td>
  </tr>
</table>
<br />

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞

–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é Android (API level) –∏ —Ç–∏–ø –æ–±—Ä–∞–∑–∞ (Google APIs –∏–ª–∏ PlayStore) –ø—Ä–∏ —Å–±–æ—Ä–∫–µ.

> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è API 33 (Google APIs, x86_64).

–≠—Ç–æ —É–¥–æ–±–Ω–æ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—Ä–∞–∑–æ–≤ –≤ CI, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Android. –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å 2 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ:

- `API_LEVEL` ‚Äî [API level](https://apilevels.com/) –æ–±—Ä–∞–∑–∞, –º–µ–Ω—è–µ—Ç –≤–µ—Ä—Å–∏—é Android.
- `IMG_TYPE` ‚Äî —Ç–∏–ø —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º–æ–≥–æ –æ–±—Ä–∞–∑–∞.
- `ARCHITECTURE` ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¶–ü–£ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ x86_64 –∏ x86).

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç—Ä–æ–∏—Ç Android Pie —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PlayStore:

```bash
docker build \
  --build-arg API_LEVEL=28 \
  --build-arg IMG_TYPE=google_apis_playstore \
  --build-arg ARCHITECTURE=x86 \
  --tag android-emulator .
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
#### –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π
DISABLE_ANIMATION=false

–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏
DISABLE_HIDDEN_POLICY=false

–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é adb
SKIP_AUTH=true

–ü–∞–º—è—Ç—å –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞
MEMORY=8192

–Ø–¥–µ—Ä –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞
CORES=4

### –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –¥–∏—Å–∫–∞

–ò–Ω–æ–≥–¥–∞ –ø–æ–ª–µ–∑–Ω–æ –¥–µ—Ä–∂–∞—Ç—å SDK –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ NFS, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –∏ —É—Å–∫–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É. –î–ª—è —ç—Ç–æ–≥–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ SDK –≤ –æ–±—Ä–∞–∑:

```bash
docker build -t android-emulator --build-arg INSTALL_ANDROID_SDK=0 .
```

> –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å SDK –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ `/opt/android`.

```bash
docker run -it --rm --device /dev/kvm -p 5555:5555 -v /shared/android/sdk:/opt/android/ android-emulator
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–æ–≤ —Å Docker Hub

–í [Docker Hub](https://hub.docker.com/r/halimqarroum/docker-android) –µ—Å—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–±—Ä–∞–∑–æ–≤. –ö–∞–∂–¥—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ç—ç–≥–∏—Ä—É–µ—Ç—Å—è –ø–æ API –∏ —Ç–∏–ø—É –æ–±—Ä–∞–∑–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è API 33:

```bash
docker pull halimqarroum/docker-android:api-33
```

## üëÄ –°–º. —Ç–∞–∫–∂–µ

- [alpine-android](https://github.com/alvr/alpine-android) ‚Äî –¥—Ä—É–≥–æ–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ –±–∞–∑–µ Alpine.
- [docker-android](https://github.com/budtmo/docker-android) ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebRTC-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–Ω–¥—Ä–æ–∏–¥-—ç–º—É–ª—è—Ç–æ—Ä–∞.
